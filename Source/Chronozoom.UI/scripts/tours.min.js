var CZ;(function(n){(function(t){function k(){var n=window.location.hash.split("@");return n.length>1&&(n=n[1].split("&")[0].split("="),n.length===2&&n[0].toLowerCase()==="auto-tour")?(t.autoTourGUID=n[1],n[1]):""}function f(t){return n.UrlNav.navStringToVisible(t.url,n.Common.vc)}function d(){return t.tour!=undefined}function g(t){var i=n.UrlNav.navStringTovcElement(t,n.Common.vc.virtualCanvas("getLayerContent"));return i?i:null}function a(n,i){if(i==undefined&&(i=t.isNarrationOn),n!=undefined){t.tour=n;t.tour.tour_TourFinished.push(function(){et();r();c()});t.tour.toggleAudio(i);for(var u=0;u<t.tour.bookmarks.length;u++)t.tour.bookmarks[u].elapsed=0;t.tour.currentPlace.bookmark=0;i==!0&&(t.tour.ReinitializeAudio(),t.tour.isAudioLoaded=!0);h()}}function v(){t.tour&&(r(),t.tour.isTourPlayRequested=!1);t.tour&&(c(),$("#bookmarks .header").text(""),t.tour.audioElement&&(t.tour.audioElement=undefined));t.tour=undefined}function nt(){t.tour!=undefined&&t.tour.prev()}function tt(){t.tour!=undefined&&t.tour.next()}function r(){t.tourCaptionForm.setPlayPauseButtonState("play");t.tour!=undefined&&($("#tour_playpause").attr("src","/images/tour_play_off.jpg"),t.tour.pause(),n.Common.controller.stopAnimation(),t.tour.tourBookmarkTransitionInterrupted=undefined,t.tour.tourBookmarkTransitionCompleted=undefined)}function h(){t.tourCaptionForm.setPlayPauseButtonState("pause");$("#tour_playpause").attr("src","/images/tour_pause_off.jpg");t.tour.play()}function it(){t.tour!=undefined&&(t.tour.state=="pause"?h():t.tour.state=="play"&&r())}function rt(){v();$("#bookmarks").hide();l=!1;var t=n.UrlNav.getURL();t.hash.params.tour&&delete t.hash.params.tour;n.UrlNav.setURL(t)}function ut(){$("#tours").hide();c()}function y(){t.tours.sort(function(n,t){return n.sequenceNum-t.sequenceNum})}function ft(){t.tourCaptionForm.hideBookmark()}function et(){t.tourCaptionForm.showTourEndMessage()}function p(n,i){t.tourCaptionForm.showBookmark(i)}function c(){$("#bookmarks").hide();l=!1}function w(){n.Search.isSearchWindowVisible&&n.Search.onSearchClicked();t.isTourWindowVisible?$("#tours").hide("slide",{},"slow"):$("#tours").show("slide",{},"slow");t.isTourWindowVisible=!t.isTourWindowVisible}function ot(){u&&(u=!1,$("#bookmarks .header").hide("slide",{},"fast"),$("#bookmarks .slideHeader").hide("slide",{},"fast"),$("#bookmarks .slideText").hide("slide",{},"fast"),$("#bookmarks .slideFooter").hide("slide",{},"fast"),$("#bookmarks").effect("size",{to:{width:"30px"}},"fast",function(){$("#bookmarks").css("width","30px")}),$("#bookmarksCollapse").attr("src","/images/expand-right.png"))}function st(){u||(u=!0,$("#bookmarks").effect("size",{to:{width:"200px",height:"auto"}},"slow",function(){$("#bookmarks").css("width","200px");$("#bookmarks").css("height","auto");$("#bookmarks .header").show("slide",{},"fast");$("#bookmarks .slideHeader").show("slide",{},"fast");$("#bookmarks .slideText").show("slide",{},"fast");$("#bookmarks .slideFooter").show("slide",{},"fast")}),$("#bookmarksCollapse").attr("src","/images/collapse-left.png"))}function ht(){u?ot():st()}function ct(){t.isNarrationOn?($("#tours-narration-on").removeClass("narration-selected","slow"),$("#tours-narration-off").addClass("narration-selected","slow")):($("#tours-narration-on").addClass("narration-selected","slow"),$("#tours-narration-off").removeClass("narration-selected","slow"));t.isNarrationOn=!t.isNarrationOn}function lt(i){var e,c,r,l,h,u,f;for(t.tours=[],e=0;e<i.d.length;e++)if(c=!0,r=i.d[e],typeof r.bookmarks!="undefined"&&typeof r.name!="undefined"&&typeof r.sequence!="undefined"&&r.bookmarks.length!=0){for(l=[],h=0;h<r.bookmarks.length;h++){if(u=r.bookmarks[h],typeof u.description=="undefined"||typeof u.lapseTime=="undefined"||typeof u.name=="undefined"||typeof u.url=="undefined"){c=!1;break}l.push(new o(u.url,u.name,u.lapseTime,u.description))}c&&(f=new s(r.id,r.name,l,b,n.Common.vc,r.category,r.audio,r.sequence,r.description),t.tours.push(f))}$("body").trigger("toursInitialized");typeof t.autoTourGUID!="undefined"&&(f=t.tours.filter(function(n){return n.id===t.autoTourGUID}),f.length===1&&t.takeTour(f[0]))}function b(i,r,u,f){t.tourBookmarkTransitionCompleted=r;t.tourBookmarkTransitionInterrupted=u;t.pauseTourAtAnyAnimation=!1;var e=n.Common.setVisible(i);return e&&f&&(n.Common.setNavigationStringTo={bookmark:f,id:e}),e}function at(){var i=n.UrlNav.getURL();typeof i.hash.params!="undefined"&&i.hash.params.tour>t.tours.length||typeof i.hash.params!="undefined"&&typeof i.hash.params.tour!="undefined"&&(t.tours==null&&y(),t.isTourWindowVisible&&w(),t.tour=t.tours[i.hash.params.tour-1],$(".touritem-selected").removeClass("touritem-selected","slow"),a(t.tour,!0),t.tour.audio&&(t.tour.audio.pause(),t.tour.audio.preload="none"),r())}function vt(t){var r=e(t),i=$("#message-window").find("textarea");n.Authoring.showMessageWindow("You can use the following web address to directly link to this tour. Try pressing Ctrl + C to copy it to your clipboard.",t.title+" URL");i.text(r).show().focus().select();setTimeout(function(){i.select()},1e3)}function e(n){return window.location.href.toLowerCase().split("#")[0]+"#@auto-tour="+n.id}function yt(n){return"http://www.facebook.com/sharer.php?u="+encodeURIComponent(e(n))}function pt(n){return"http://twitter.com/share?url="+encodeURIComponent(e(n))+"&hashtags=chronozoom&text="+encodeURIComponent(n.title+" - ")}var i,o,s;t.isTourWindowVisible=!1;var l=!1,u=!0;t.isNarrationOn=!0;t.tours;t.tour;t.autoTourGUID;t.tourBookmarkTransitionCompleted;t.tourBookmarkTransitionInterrupted;t.pauseTourAtAnyAnimation=!1;i=!1;t.TourEndMessage="Thank you for watching this tour!";t.tourCaptionFormContainer;t.tourCaptionForm;t.getAutoTourGUID=k;o=function(){function n(n,t,i,r){this.url=n;this.caption=t;this.lapseTime=i;this.text=r;this.duration=undefined;this.elapsed=0;this.text===null&&(this.text="")}return n}();t.TourBookmark=o;t.getBookmarkVisible=f;t.hasActiveTour=d;t.bookmarkUrlToElement=g;s=function(){function u(u,e,o,s,h,c,l,a,v){var y,w;if(this.id=u,this.title=e,this.bookmarks=o,this.zoomTo=s,this.vc=h,this.category=c,this.audio=l,this.sequenceNum=a,this.description=v,this.tour_BookmarkStarted=[],this.tour_BookmarkFinished=[],this.tour_TourStarted=[],this.tour_TourFinished=[],this.state="pause",this.currentPlace={type:"goto",bookmark:0,startTime:null,animationId:null},this.isTourPlayRequested=!1,this.isAudioLoaded=!1,this.isAudioEnabled=!1,!o||o.length==0)throw"Tour has no bookmarks";for(this.audio=n.Service.MakeSecureUri(l),y=this,this.thumbnailUrl=n.Settings.contentItemThumbnailBaseUri+u+".jpg",o.sort(function(n,t){return n.lapseTime-t.lapseTime}),w=1;w<o.length;w++)o[w-1].number=w,o[w-1].duration=o[w].lapseTime-o[w-1].lapseTime;o[o.length-1].duration=10;o[o.length-1].number=o.length;y.toggleAudio=function(n){y.isAudioEnabled=n&&y.audio?!0:!1};y.ReinitializeAudio=function(){var u,t,r;if(y.audio){for(y.audioElement&&y.audioElement.pause(),y.audioElement=undefined,y.isAudioLoaded=!1,y.audioElement=document.createElement("audio"),y.audioElement.addEventListener("loadedmetadata",function(){y.audioElement.duration!=Infinity&&(y.bookmarks[y.bookmarks.length-1].duration=y.audioElement.duration-y.bookmarks[y.bookmarks.length-1].lapseTime);i&&window.console&&console.log("Tour "+y.title+" metadata loaded (readystate 1)")}),y.audioElement.addEventListener("canplaythrough",function(){y.isAudioLoaded=!0;i&&window.console&&console.log("Tour "+y.title+" readystate 4")}),y.audioElement.addEventListener("progress",function(){y.audioElement&&y.audioElement.buffered.length>0&&i&&window.console&&console.log("Tour "+y.title+" downloaded "+y.audioElement.buffered.end(y.audioElement.buffered.length-1)/y.audioElement.duration)}),y.audioElement.controls=!1,y.audioElement.autoplay=!1,y.audioElement.loop=!1,y.audioElement.volume=1,y.audioElement.preload="none",u=y.audio.substring(0,y.audio.length-3),t=0;t<n.Settings.toursAudioFormats.length;t++)r=document.createElement("Source"),r.setAttribute("src",u+n.Settings.toursAudioFormats[t].ext),y.audioElement.appendChild(r);y.audioElement.load();i&&window.console&&console.log("Loading of tour "+y.title+" is queued")}};y.onBookmarkIsOver=function(n){y.bookmarks[y.currentPlace.bookmark].elapsed=0;y.currentPlace.bookmark!=y.bookmarks.length-1||n?y.goToTheNextBookmark(n):(y.state="pause",y.currentPlace={type:"goto",bookmark:0},y.RaiseTourFinished())};y.goToTheNextBookmark=function(n){var t=y.currentPlace.bookmark,e=t,r,u;if(t=n?Math.max(0,t-1):Math.min(y.bookmarks.length-1,t+1),y.RaiseBookmarkFinished(e),y.currentPlace={type:"goto",bookmark:t},r=y.bookmarks[y.currentPlace.bookmark],t!=0&&(y.RaiseBookmarkStarted(r),y.isAudioEnabled&&y.state==="play"&&y.isAudioLoaded==!0&&y.startBookmarkAudio(r)),y.state!="pause"&&y.isAudioLoaded==!0&&y.setTimer(r),i&&window.console&&console.log("Transitioning to the bm index "+t),u=f(r),!u){i&&window.console&&console.log("bookmark index "+t+" references to nonexistent item");n?y.prev():y.next();return}y.currentPlace.animationId=y.zoomTo(f(r),y.onGoToSuccess,y.onGoToFailure,r.url)};y.startBookmarkAudio=function(n){if(y.audio){i&&window.console&&console.log("playing source: "+y.audioElement.currentSrc);y.audioElement.pause();try{y.audioElement.currentTime=n.lapseTime+n.elapsed;i&&window.console&&console.log("audio currentTime is set to "+(n.lapseTime+n.elapsed))}catch(t){window.console&&console.error("currentTime assignment: "+t)}i&&window.console&&console.log("audio element is forced to play");y.audioElement.play()}};y.setTimer=function(n){y.timerOnBookmarkIsOver&&clearTimeout(y.timerOnBookmarkIsOver);var t=n.duration;n.elapsed!=0&&(t=Math.max(t-n.elapsed,0));y.currentPlace.startTime=(new Date).getTime();i&&window.console&&console.log("transition to next bookmark will be in "+t+" seconds");y.timerOnBookmarkIsOver=setTimeout(y.onBookmarkIsOver,t*1e3)};y.onGoToSuccess=function(u){var f,e;y.currentPlace&&y.currentPlace.animationId!=undefined&&y.currentPlace.animationId==u&&(f=n.UrlNav.getURL(),typeof f.hash.params=="undefined"&&(f.hash.params=[]),f.hash.params.tour=t.tour.sequenceNum,n.Common.hashHandle=!1,n.UrlNav.setURL(f),i&&window.console&&console.log("reached the bookmark index "+y.currentPlace.bookmark),y.currentPlace={type:"bookmark",bookmark:y.currentPlace.bookmark},y.currentPlace.bookmark==0&&(e=y.bookmarks[y.currentPlace.bookmark],y.RaiseBookmarkStarted(e),y.state!="pause"&&(y.isAudioLoaded!=!0?r():(y.setTimer(e),y.isAudioEnabled&&y.startBookmarkAudio(e)))))};y.onGoToFailure=function(n){y.currentPlace&&y.currentPlace.animationId!=undefined&&y.currentPlace.animationId==n&&(y.pause(),i&&window.console&&console.log("tour interrupted by user during transition"))};y.play=function(){var o,e,r,s,u;if(y.state==="pause"){if(i&&window.console&&console.log("tour playback activated"),y.state="play",o=y.vc.virtualCanvas("getViewport").visible,e=f(y.bookmarks[y.currentPlace.bookmark]),e===null){y.next();return}y.currentPlace=y.currentPlace!=null&&y.currentPlace.bookmark!=null&&n.Common.compareVisibles(o,e)?{type:"bookmark",bookmark:y.currentPlace.bookmark}:{type:"goto",bookmark:y.currentPlace.bookmark};r=y.bookmarks[y.currentPlace.bookmark];p(t.tour,r);s=y.currentPlace.bookmark==0&&y.currentPlace.type=="goto";(y.currentPlace.type=="bookmark"||y.currentPlace.bookmark!=0)&&(y.RaiseBookmarkStarted(r),y.isAudioLoaded==!0&&(y.setTimer(r),y.isAudioEnabled&&y.startBookmarkAudio(r)));y.currentPlace.animationId=y.zoomTo(f(r),y.onGoToSuccess,y.onGoToFailure,r.url);y.currentPlace.bookmark===0&&s&&y.RaiseTourStarted();u=n.UrlNav.getURL();typeof u.hash.params=="undefined"&&(u.hash.params=[]);typeof u.hash.params.tour=="undefined"&&(u.hash.params.tour=t.tour.sequenceNum,n.Common.hashHandle=!1,n.UrlNav.setURL(u))}};y.pause=function(){if(y.state==="play"){i&&window.console&&console.log("tour playback paused");y.isAudioEnabled&&y.isTourPlayRequested&&(y.isTourPlayRequested=!1);y.timerOnBookmarkIsOver&&(clearTimeout(y.timerOnBookmarkIsOver),y.timerOnBookmarkIsOver=undefined);y.state="pause";y.isAudioEnabled&&(y.audioElement.pause(),i&&window.console&&console.log("audio element is forced to pause"));var n=y.bookmarks[y.currentPlace.bookmark];y.currentPlace.startTime&&(n.elapsed+=((new Date).getTime()-y.currentPlace.startTime)/1e3)}};y.next=function(){y.state==="play"&&(y.timerOnBookmarkIsOver&&clearTimeout(y.timerOnBookmarkIsOver),y.timerOnBookmarkIsOver=undefined);y.onBookmarkIsOver(!1)};y.prev=function(){if(y.currentPlace.bookmark!=0){y.state==="play"&&(y.timerOnBookmarkIsOver&&clearTimeout(y.timerOnBookmarkIsOver),y.timerOnBookmarkIsOver=undefined);y.onBookmarkIsOver(!0)}};y.RaiseBookmarkStarted=function(n){if(y.tour_BookmarkStarted.length>0)for(var t=0;t<y.tour_BookmarkStarted.length;t++)y.tour_BookmarkStarted[t](y,n);p(this,n)};y.RaiseBookmarkFinished=function(n){if(y.tour_BookmarkFinished.length>0)for(var t=0;t<y.tour_BookmarkFinished.length;t++)y.tour_BookmarkFinished[t](y,n);ft(this)};y.RaiseTourStarted=function(){if(y.tour_TourStarted.length>0)for(var n=0;n<y.tour_TourStarted.length;n++)y.tour_TourStarted[n](y)};y.RaiseTourFinished=function(){if(y.tour_TourFinished.length>0)for(var n=0;n<y.tour_TourFinished.length;n++)y.tour_TourFinished[n](y)}}return u}();t.Tour=s;t.activateTour=a;t.removeActiveTour=v;t.tourPrev=nt;t.tourNext=tt;t.tourPause=r;t.tourResume=h;t.tourPlayPause=it;t.tourAbort=rt;t.initializeToursUI=ut;t.initializeToursContent=y;t.onTourClicked=w;t.onBookmarksCollapse=ht;t.onNarrationClick=ct;t.parseTours=lt;t.bookmarkTransition=b;t.loadTourFromURL=at;t.showAutoTourURL=vt;t.getAutoTourURL=e;t.getFacebookURL=yt;t.getTwitterURL=pt})(n.Tours||(n.Tours={}));var t=n.Tours})(CZ||(CZ={}));
//# sourceMappingURL=tours.min.js.map
