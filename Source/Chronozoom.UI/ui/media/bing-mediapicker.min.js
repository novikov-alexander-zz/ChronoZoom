var CZ;(function(n){(function(t){var i=function(){function t(t,i,r){this.container=t;this.contentItem=i;this.editContentItemForm=r?r:n.HomePageViewModel.getFormById("#auth-edit-contentitem-form");this.searchTextbox=this.container.find(".cz-bing-search-input");this.mediaTypeRadioButtons=this.container.find(":radio");this.progressBar=this.container.find(".cz-form-progress-bar");this.searchResultsBox=this.container.find(".cz-bing-search-results");this.searchButton=this.container.find(".cz-bing-search-button");this.initialize()}return t.setup=function(i,r){var s=n.Media.mediaPickersViews.bing,f=new t(s,i,r),e=$(".cz-form-bing-mediapicker"),u,o;e.length===0&&(e=$("#mediapicker-form").clone().removeAttr("id").addClass("cz-form-bing-mediapicker").appendTo($("#content")));u=new n.UI.FormMediaPicker(e,s,"Import from Bing",{activationSource:$(),navButton:".cz-form-nav",closeButton:".cz-form-close-btn > .cz-form-btn",titleTextblock:".cz-form-title",contentContainer:".cz-form-content"});$(u).on("showcompleted",function(){f.searchTextbox.focus()});$(f).on("resultclick",function(){u.close()});o=function(){return f.onWindowResize()};$(window).on("resize",o);$(u).on("closecompleted",function(){$(window).off("resize",o)});u.show()},t.prototype.initialize=function(){var n=this;this.progressBar.css("opacity",0);this.searchTextbox.off();this.searchButton.off();$(this).off();this.searchTextbox.keypress(function(t){var i=t.which||t.keyCode;i===13&&(t.preventDefault(),n.search())});this.searchButton.click(function(){n.search()});$(this).on("resultclick",function(t,i){n.onSearchResultClick(i)})},t.prototype.onSearchResultClick=function(n){$.extend(this.contentItem,n);this.editContentItemForm.updateMediaInfo()},t.prototype.getMediaType=function(){return this.mediaTypeRadioButtons.filter(":checked").val()},t.prototype.convertResultToMediaInfo=function(n,t){var i={image:{uri:n.MediaUrl,mediaType:t,mediaSource:n.SourceUrl,attribution:n.SourceUrl},video:{uri:n.MediaUrl,mediaType:t,mediaSource:n.MediaUrl,attribution:n.MediaUrl},pdf:{uri:n.Url,mediaType:t,mediaSource:n.Url,attribution:n.Url}};return i[t]},t.prototype.search=function(){var n=this.searchTextbox.val(),t=this.getMediaType();if(n.trim()!==""){_gaq.push(["_trackEvent","Search","Bing Search",t]);this.searchResultsBox.empty();this.showProgressBar();switch(t){case"image":this.searchImages(n);break;case"video":this.searchVideos(n);break;case"document":this.searchDocuments(n)}}},t.prototype.searchImages=function(t){var i=this;n.Service.getBingImages(t).done(function(n){var t,r,u,f;if(i.hideProgressBar(),n.d.length===0){i.showNoResults();return}for(t=0,r=n.d.length;t<r;++t)u=n.d[t],f=i.createImageResult(u),i.searchResultsBox.append(f),i.alignThumbnails()}).fail(function(n){i.hideProgressBar();i.showErrorMessage(n)})},t.prototype.searchVideos=function(t){var i=this;t+=" (+site:youtube.com OR +site:vimeo.com)";n.Service.getBingVideos(t).done(function(n){var t,r,u,f;if(i.hideProgressBar(),n.d.length===0){i.showNoResults();return}for(t=0,r=n.d.length;t<r;++t)u=n.d[t],f=i.createVideoResult(u),i.searchResultsBox.append(f),i.alignThumbnails()}).fail(function(n){i.hideProgressBar();i.showErrorMessage(n)})},t.prototype.searchDocuments=function(t){var i=this;n.Service.getBingDocuments(t,"pdf").done(function(n){var t,r,u,f;if(i.hideProgressBar(),n.d.length===0){i.showNoResults();return}for(t=0,r=n.d.length;t<r;++t)u=n.d[t],f=i.createDocumentResult(u),i.searchResultsBox.append(f)}).fail(function(n){i.hideProgressBar();i.showErrorMessage(n)})},t.prototype.createImageResult=function(t){var u=this,i=this.fitThumbnailToContainer(t.Thumbnail.Width/t.Thumbnail.Height,n.Settings.mediapickerImageThumbnailMaxWidth,n.Settings.mediapickerImageThumbnailMaxHeight),s=(n.Settings.mediapickerImageThumbnailMaxHeight-i.height)/2,h=$("<div><\/div>",{"class":"cz-bing-result-container",width:i.width,"data-actual-width":i.width}),f=$("<div><\/div>",{"class":"cz-bing-result-title cz-darkgray",text:t.Title,title:t.Title}),e=$("<div><\/div>",{"class":"cz-bing-result-description cz-lightgray",text:t.Width+"x"+t.Height+" - "+Math.round(t.FileSize/8192)+" KB"}),c=$("<a><\/a>",{"class":"cz-bing-result-description cz-lightgray",text:t.DisplayUrl,href:t.MediaUrl,title:t.DisplayUrl,"media-source":t.SourceUrl,target:"_blank"}),r=$("<div><\/div>",{width:"100%",height:n.Settings.mediapickerImageThumbnailMaxHeight}),o=$("<img><\/img>",{"class":"cz-bing-result-thumbnail",src:t.Thumbnail.MediaUrl,height:i.height,width:"100%"});return o.css("padding-top",s+"px"),r.add(f).add(e).click(function(){$(u).trigger("resultclick",u.convertResultToMediaInfo(t,"image"))}),r.append(o),h.append(r).append(f).append(e).append(c)},t.prototype.createVideoResult=function(t){var u=this;t.Thumbnail=t.Thumbnail||this.createDefaultThumbnail();var i=this.fitThumbnailToContainer(t.Thumbnail.Width/t.Thumbnail.Height,n.Settings.mediapickerVideoThumbnailMaxWidth,n.Settings.mediapickerVideoThumbnailMaxHeight),s=(n.Settings.mediapickerVideoThumbnailMaxHeight-i.height)/2,h=$("<div><\/div>",{"class":"cz-bing-result-container",width:i.width,"data-actual-width":i.width}),f=$("<div><\/div>",{"class":"cz-bing-result-title cz-darkgray",text:t.Title,title:t.Title}),e=$("<div><\/div>",{"class":"cz-bing-result-description cz-lightgray",text:"Duration - "+t.RunTime/1e3+" seconds"}),c=$("<a><\/a>",{"class":"cz-bing-result-description cz-lightgray",text:t.MediaUrl,href:t.MediaUrl,title:t.MediaUrl,target:"_blank"}),r=$("<div><\/div>",{width:"100%",height:n.Settings.mediapickerVideoThumbnailMaxHeight}),o=$("<img><\/img>",{"class":"cz-bing-result-thumbnail",src:t.Thumbnail.MediaUrl,height:i.height,width:"100%"});return o.css("padding-top",s+"px"),r.add(f).add(e).click(function(){$(u).trigger("resultclick",u.convertResultToMediaInfo(t,"video"))}),r.append(o),h.append(r).append(f).append(e).append(c)},t.prototype.createDocumentResult=function(n){var t=this,u=$("<div><\/div>",{"class":"cz-bing-result-container",width:300}),i=$("<div><\/div>",{"class":"cz-bing-result-title cz-darkgray",text:n.Title,title:n.Title}),r=$("<div><\/div>",{"class":"cz-bing-result-doc-description cz-lightgray",height:100,text:n.Description}),f=$("<a><\/a>",{"class":"cz-bing-result-description cz-lightgray",text:n.DisplayUrl,href:n.Url,title:n.DisplayUrl,target:"_blank"});return i.add(r).click(function(){$(t).trigger("resultclick",t.convertResultToMediaInfo(n,"pdf"))}),u.append(i).append(r).append(f)},t.prototype.showProgressBar=function(){this.progressBar.animate({opacity:1})},t.prototype.hideProgressBar=function(){this.progressBar.animate({opacity:0})},t.prototype.showNoResults=function(){this.searchResultsBox.text("No results.")},t.prototype.createDefaultThumbnail=function(){return{ContentType:"image/png",FileSize:4638,Width:500,Height:500,MediaUrl:"/images/Temp-Thumbnail2.png"}},t.prototype.showErrorMessage=function(n){var t=$("<span><\/span>",{"class":"cz-red",text:{"400":"The search request is formed badly. Please contact developers about the error.","403":"Please sign in to ChronoZoom to use Bing search.","500":"We are sorry, but something went wrong. Please try again later."}[n.status]});this.searchResultsBox.append(t)},t.prototype.onWindowResize=function(){this.alignThumbnails()},t.prototype.alignThumbnails=function(){var h=this.searchResultsBox,u=h.children(),f,n,i,c,v,r,o,s,y;if(u.length!==0)for(f=h.width(),n={elements:[],width:0},i=0,c=u.length;i<c;i++){var t=$(u[i]),e=+t.attr("data-actual-width"),l=t.outerWidth(!0),a=t.innerWidth();if(f<n.width+e){for(v=f-n.width,r=0,o=n.elements.length;r<o;r++)s=n.elements[r],y=+s.attr("data-actual-width"),s.width(y+v/o);n.elements=[];n.elements.push(t);n.width=Math.ceil(e+l-a)}else n.elements.push(t),n.width+=Math.ceil(e+l-a)}},t.prototype.fitThumbnailToContainer=function(n,t,i){var u=t/i,r={width:i*n,height:i};return n>u&&(r.width=t,r.height=t/n),r},t}();t.BingMediaPicker=i})(n.Media||(n.Media={}));var t=n.Media})(CZ||(CZ={}));
/*
//# sourceMappingURL=bing-mediapicker.min.js.map
*/